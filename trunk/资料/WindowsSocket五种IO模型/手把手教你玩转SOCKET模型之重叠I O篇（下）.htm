<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0036)http://archive.cnblogs.com/a/129728/ -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>手把手教你玩转SOCKET模型之重叠I/O篇（下） - 博客文库 - 博客园</title> 
<link href="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/archive.css" rel="stylesheet" type="text/css">
<link type="text/css" rel="stylesheet" href="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/shCore.css">
<link type="text/css" rel="stylesheet" href="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/shThemeDefault.css">
<script src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/jquery.js" type="text/javascript"></script>
<script src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/archive.js" type="text/javascript"></script>
</head>
<body>
<div class="top_nav"><a href="http://www.cnblogs.com/">« 博客园首页</a></div>
<div id="wrapper">
<h1 class="contents_header">手把手教你玩转SOCKET模型之重叠I/O篇（下）</h1>
<div class="contents_info">
	作者：<a href="http://www.cnblogs.com/xw885/" target="_blank">萧萧</a>&nbsp;&nbsp;来源：<a href="http://www.cnblogs.com/" target="_blank">博客园</a>&nbsp;&nbsp;发布时间：2005-03-31 22:24&nbsp;&nbsp;阅读：496 次&nbsp;&nbsp;<a href="http://www.cnblogs.com/xw885/articles/129728.html">原文链接</a>&nbsp;&nbsp;
	<a href="javascript:add_to_wz()" class="graylink">[收藏]</a>&nbsp;&nbsp;
</div>
<div class="contents_main">
	<h2><a id="viewpost.ascx_TitleUrl" href="http://blog.csdn.net/piggyxp/archive/2004/09/23/114908.aspx"><font color="#009933">手把手教你玩转SOCKET模型之重叠I/O篇（下）</font></a> </h2>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 18pt; TEXT-INDENT: -18pt; mso-list: l1 level1 lfo1; tab-stops: list 18.0pt"><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="COLOR: fuchsia; FONT-FAMILY: Verdana; mso-bidi-font-size: 10.5pt; mso-bidi-font-family: 宋体"><span style="mso-list: Ignore"><span style="FONT: 7pt &#39;Times New Roman&#39;"><font face="宋体" size="3"><strong>四。</strong></font> &nbsp;&nbsp;&nbsp; </span></span></span></b><b style="mso-bidi-font-weight: normal"><span style="COLOR: fuchsia; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana; mso-bidi-font-size: 10.5pt">实现重叠模型的步骤</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="COLOR: fuchsia; FONT-FAMILY: Verdana; mso-bidi-font-size: 10.5pt"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">作了这么多的准备工作，费了这么多的笔墨，我们终于可以开始着手编码了。其实慢慢的你就会明白，要想透析重叠结构的内部原理也许是要费点功夫，但是只是学会如何来使用它，却是真的不难，唯一需要理清思路的地方就是和大量的客户端交互的情况下，我们得到事件通知以后，如何得知是哪一个重叠操作完成了，继而知道究竟该对哪一个套接字进行处理，应该去哪个缓冲区中的取得数据，</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">everything will be OK^_^</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">下面我们配合代码，来一步步的讲解如何亲手完成一个重叠模型。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">【<b style="mso-bidi-font-weight: normal">第一步</b>】<b style="mso-bidi-font-weight: normal">定义变量</b></span><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana">…………</span></b><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">#define DATA_BUFSIZE<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span>4096<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun: yes">&nbsp;&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">接收缓冲区大小</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">SOCKET <span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ListenSocket, <span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">监听套接字</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 94.5pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 10.5; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">AcceptSocket;<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;</span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun: yes">&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-spacerun: yes">&nbsp;</span>// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">与客户端通信的套接字</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">WSAOVERLAPPED<span style="mso-spacerun: yes">&nbsp; </span>AcceptOverlapped; <span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">重叠结构一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">WSAEVENT<span style="mso-spacerun: yes">&nbsp; </span>EventArray[WSA_MAXIMUM_WAIT_EVENTS];<span style="mso-spacerun: yes">&nbsp; </span><o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 216pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 24.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">用来通知重叠操作完成的事件句柄数组</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">WSABUF<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span>DataBuf[DATA_BUFSIZE] ;<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">DWORD <span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;</span>dwEventTotal = 0, <span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun: yes">&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">程序中事件的总数</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun: yes">&nbsp;</span>dwRecvBytes = 0,<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun: yes">&nbsp;&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">接收到的字符长度</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly; tab-stops: 68.25pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp; </span>Flags = 0;<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun: yes">&nbsp;&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-spacerun: yes">&nbsp;</span>// WSARecv</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">的参数</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p><font style="BACKGROUND-COLOR: #dddddd">&nbsp;</font></o:p></span></pre>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18.05pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">【第二步】创建一个套接字，开始在指定的端口上监听连接请求</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">和其他的</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">初始化全无二致，直接照搬即可，在此也不多费唇舌了，需要注意的是为了一目了然，我去掉了错误处理，平常可不要这样啊，尽管这里出错的几率比较小。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">WSADATA wsaData;<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">WSAStartup(MAKEWORD(2,2),&amp;wsaData);<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p><font style="BACKGROUND-COLOR: #dddddd">&nbsp;</font></o:p></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">ListenSocket = socket(AF_INET,SOCK_STREAM,IPPROTO_TCP);<span style="mso-spacerun: yes">&nbsp; </span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">//</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">创建</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">TCP</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">套接字</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p><font style="BACKGROUND-COLOR: #dddddd">&nbsp;</font></o:p></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">SOCKADDR_IN ServerAddr;<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">//</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">分配端口及协议族并绑定</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">ServerAddr.sin_family=AF_INET;<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">ServerAddr.sin_addr.S_un.S_addr<span style="mso-spacerun: yes">&nbsp; </span>=htonl(INADDR_ANY);<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">ServerAddr.sin_port=htons(11111);<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p><font style="BACKGROUND-COLOR: #dddddd">&nbsp;</font></o:p></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">bind(ListenSocket,(LPSOCKADDR)&amp;ServerAddr, sizeof(ServerAddr)); </span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">绑定套接字</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p><font style="BACKGROUND-COLOR: #dddddd">&nbsp;</font></o:p></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">listen(ListenSocket, 5);<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-spacerun: yes">&nbsp;</span>//</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">开始监听</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18.05pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18.05pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">【第三步】接受一个入站的连接请求</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp; </span></span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">accept</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">就完了，都是一样一样一样一样的啊</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">~~~~~~~~~~<o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp;</span></span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">至于</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">AcceptEx</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">的使用，在完成端口中我会讲到，这里就先不一次灌输这么多了，不消化啊</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">^_^<o:p></o:p></span>
</p><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">AcceptSocket = accept (ListenSocket, NULL,NULL) ; <o:p></o:p></span></font></pre>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 22.5pt; mso-char-indent-count: 2.5"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">当然，这里是我偷懒，如果想要获得连入客户端的信息（记得论坛上也常有人问到），</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">accept</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">的后两个参数就不要用</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">NULL</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，而是这样</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">SOCKADDR_IN ClientAddr;<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">定义一个客户端得地址结构作为参数</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">int addr_length=sizeof(ClientAddr);<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">AcceptSocket = accept(ListenSocket,(SOCKADDR*)&amp;ClientAddr, &amp;addr_length);<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">于是乎，我们就可以轻松得知连入客户端的信息了</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">LPCTSTR lpIP =<span style="mso-spacerun: yes">&nbsp; </span>inet_ntoa(ClientAddr.sin_addr);<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// IP</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 15pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">UINT nPort = ClientAddr.sin_port;<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// Port</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; mso-char-indent-count: 2.0"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18.05pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">【第四步】建立并初始化重叠结构</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">为连入的这个套接字新建立一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAOVERLAPPED</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">重叠结构，并且象前面讲到的那样，为这个重叠结构从事件句柄数组里挑出一个空闲的对象句柄“绑定”上去。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">创建一个事件</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// dwEventTotal</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">可以暂时先作为</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">Event</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">数组的索引</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">EventArray[dwEventTotal] = WSACreateEvent();<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p><font style="BACKGROUND-COLOR: #dddddd">&nbsp;</font></o:p></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">ZeroMemory(&amp;AcceptOverlapped, sizeof(WSAOVERLAPPED)); <span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="mso-spacerun: yes">&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">置零</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">AcceptOverlapped.hEvent = EventArray[dwEventTotal];<span style="mso-spacerun: yes">&nbsp; </span><span style="mso-spacerun: yes">&nbsp;</span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">关联事件</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p><font style="BACKGROUND-COLOR: #dddddd">&nbsp;</font></o:p></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">char buffer[DATA_BUFSIZE];<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">ZeroMemory(buffer, DATA_BUFSIZE);<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">DataBuf.len = DATA_BUFSIZE;<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">DataBuf.buf = buffer;<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">初始化一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">WSABUF</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">dwEventTotal ++;<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">总数加一</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; mso-char-indent-count: 2.0"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18.05pt; mso-char-indent-count: 2.0"><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">【第五步】以</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana">WSAOVERLAPPED</span></b><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构为参数，在套接字上投递</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana">WSARecv</span></b><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">请求</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; mso-char-indent-count: 2.0"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">各个变量都已经初始化</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">OK</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">以后，我们就可以开始</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">Socket</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">操作了，然后让</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAOVERLAPPED</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构来替我们管理</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">I/O </span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">请求，我们只用等待事件的触发就</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">OK</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">了。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">if(WSARecv(AcceptSocket ,&amp;DataBuf,1,&amp;dwRecvBytes,&amp;Flags,<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd"><span style="mso-tab-count: 3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>&amp; AcceptOverlapped, NULL) == SOCKET_ERROR)<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">{ <o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;</span>/</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-hansi-font-family: &#39;Courier New&#39;">/ </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-hansi-font-family: &#39;Courier New&#39;">返回<span lang="EN-US">WSA_IO_PENDING</span>是正常情况，表示<span lang="EN-US">IO</span>操作正在进行，不能立即完成</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-spacerun: yes">&nbsp; </span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-spacerun: yes">&nbsp;</span>// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">如果不是</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">WSA_IO_PENDING</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">错误，就大事不好了</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">~~~~~~</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">！！！</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly; tab-stops: 36.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>if(WSAGetLastError() != WSA_IO_PENDING)<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span><o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly; tab-stops: 36.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>{<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly; tab-stops: 36.75pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-spacerun: yes">&nbsp;</span>// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">那就只能关闭大吉了</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd"><span style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>closesocket(AcceptSocket);<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd"><span style="mso-tab-count: 2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>WSACloseEvent(EventArray[dwEventTotal]);<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>}<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">}<o:p></o:p></font></span></pre>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; mso-char-indent-count: 2.0"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18.05pt; LINE-HEIGHT: 17pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">【第六步】</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana">&nbsp;</span></b><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">用</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana">WSAWaitForMultipleEvents</span></b><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">函数等待重叠操作返回的结果</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 9.05pt; TEXT-INDENT: 8.75pt; LINE-HEIGHT: 17pt; mso-char-indent-count: .97; mso-line-height-rule: exactly; mso-para-margin-left: .86gd"><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp; </span></span></b><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">我们前面已经给</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSARecv</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">关联的重叠结构赋了一个事件对象句柄，所以我们这里要等待事件对象的触发与之配合，而且需要根据</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAWaitForMultipleEvents</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">函数的返回值来确定究竟事件数组中的哪一个事件被触发了，这个函数的用法及返回值请参考前面的基础知识部分。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">DWORD dwIndex;<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">等候重叠</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">I/O</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">调用结束</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">因为我们把事件和</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">Overlapped</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">绑定在一起，重叠操作完成后我们会接到事件通知</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">dwIndex = WSAWaitForMultipleEvents(dwEventTotal, <o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 130.5pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 14.5; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">EventArray ,FALSE ,WSA_INFINITE,FALSE);<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">注意这里返回的</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">Index</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">并非是事件在数组里的</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">Index</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，而是需要减去</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">WSA_WAIT_EVENT_0<o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">dwIndex = dwIndex – WSA_WAIT_EVENT_0;<o:p></o:p></font></span></pre>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; mso-char-indent-count: 2.0"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18.05pt; mso-char-indent-count: 2.0"><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">【第七步】使用</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana">WSAResetEvent</span></b><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">函数重设当前这个用完的事件对象</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 13.55pt; TEXT-INDENT: 13.5pt; mso-char-indent-count: 1.5; mso-para-margin-left: 1.29gd"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">事件已经被触发了之后，它对于我们来说已经没有利用价值了，所以要将它重置一下留待下一次使用，很简单，就一步，连返回值都不用考虑</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">WSAResetEvent(EventArray[dwIndex]);<o:p></o:p></font></span></pre>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 13.55pt; TEXT-INDENT: 13.5pt; mso-char-indent-count: 1.5; mso-para-margin-left: 1.29gd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18.05pt; mso-char-indent-count: 2.0"><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">【第八步】使用</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana">WSAGetOverlappedResult</span></b><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">函数取得重叠调用的返回状态</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; mso-char-indent-count: 2.0"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp; </span></span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">这是我们最关心的事情，费了那么大劲投递的这个重叠操作究竟是个什么结果呢？其实对于本模型来说，唯一需要检查一下的就是对方的</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">Socket</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">连接是否已经关闭了</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">DWORD dwBytesTransferred;<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly; tab-stops: 41.25pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">WSAGetOverlappedResult( AcceptSocket, AcceptOverlapped ,<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 130.5pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 14.5; mso-line-height-rule: exactly; tab-stops: 41.25pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">&amp;dwBytesTransferred, FALSE, &amp;Flags);<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">先检查通信对方是否已经关闭连接</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">如果</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">==0</span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">则表示连接已经，则关闭套接字</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">if(dwBytesTransferred == 0)<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">{<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>closesocket(AcceptSocket);<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><font style="BACKGROUND-COLOR: #dddddd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>WSACloseEvent(EventArray[dwIndex]);<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体">// </span><span style="FONT-SIZE: 9pt; COLOR: green; FONT-FAMILY: 新宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">关闭事件</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><o:p></o:p></span></font></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd"><span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>return;<o:p></o:p></font></span></pre><pre style="BACKGROUND: #dddddd; TEXT-INDENT: 18pt; LINE-HEIGHT: 14pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: 新宋体"><font style="BACKGROUND-COLOR: #dddddd">}<o:p></o:p></font></span></pre>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; mso-char-indent-count: 2.0"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18.05pt; LINE-HEIGHT: 18pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">【第九步】“享受”接收到的数据</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 4.5pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly; mso-para-margin-left: .43gd"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">如果程序执行到了这里，那么就说明一切正常，</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSABUF</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构里面就存有我们</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSARecv</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">来的数据了，终于到了尽情享用成果的时候了！喝杯茶，休息一下吧</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">~~~^_^<o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 4.5pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly; mso-para-margin-left: .43gd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">DataBuf.buf</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">就是一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">char*</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">字符串指针，听凭你的处理吧，我就不多说了</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18.05pt; LINE-HEIGHT: 18pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">【第十步】同第五步一样，在套接字上继续投递</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana">WSARecv</span></b><b style="mso-bidi-font-weight: normal"><span style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">请求，重复步骤</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: #ff6600; FONT-FAMILY: Verdana"> 6 ~ 9<o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 4.5pt; TEXT-INDENT: 13.5pt; LINE-HEIGHT: 18pt; mso-char-indent-count: 1.5; mso-line-height-rule: exactly; mso-para-margin-left: .43gd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp;</span></span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">这样一路作下来，我们终于可以从客户端接收到数据了，但是回想起来，呀</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">~~~~~</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，这样岂不是只能收到一次数据，然后程序不就</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">Over</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">了？</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">…….-_-b<span style="mso-spacerun: yes">&nbsp; </span></span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">所以我们接下来不得不重复一遍第四步和第五步的工作，再次在这个套接字上投递另一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSARecv</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">请求，并且使整个过程循环起来，</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">are u clear</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">？？</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 4.5pt; TEXT-INDENT: -4.5pt; LINE-HEIGHT: 18pt; mso-char-indent-count: -.5; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">大家可以参考我的代码，在这里就先不写了，因为各位都一定比我</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">smart</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，领悟了关键所在以后，稍作思考就可以灵活变通了。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 18pt; TEXT-INDENT: -18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly; mso-list: l1 level1 lfo1; tab-stops: list 18.0pt"><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="COLOR: fuchsia; FONT-FAMILY: Verdana; mso-bidi-font-size: 10.5pt; mso-bidi-font-family: 宋体"><span style="mso-list: Ignore"><span style="FONT: 7pt &#39;Times New Roman&#39;"><strong><font face="Verdana" size="3">五。</font></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span></b><b style="mso-bidi-font-weight: normal"><span style="COLOR: fuchsia; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana; mso-bidi-font-size: 10.5pt">多客户端情况的注意事项</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="COLOR: fuchsia; FONT-FAMILY: Verdana; mso-bidi-font-size: 10.5pt"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 5.15pt; TEXT-INDENT: -5.15pt; LINE-HEIGHT: 18pt; mso-char-indent-count: -.49; mso-line-height-rule: exactly"><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="COLOR: fuchsia; FONT-FAMILY: Verdana; mso-bidi-font-size: 10.5pt"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span></span></b><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">完成了上面的循环以后，重叠模型就已经基本上搭建好了</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">80%</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">了，为什么不是</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">100%</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">呢？因为仔细一回想起来，呀</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">~~~~~~~</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，这样岂不是只能连接一个客户端？？是的，如果只处理一个客户端，那重叠模型就半点优势也没有了，我们正是要使用重叠模型来处理多个客户端。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 4.4pt; TEXT-INDENT: -4.4pt; LINE-HEIGHT: 18pt; mso-char-indent-count: -.49; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">所以我们不得不再对结构作一些改动。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 22.5pt; TEXT-INDENT: -18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly; mso-list: l2 level1 lfo3; tab-stops: list 22.5pt"><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: red; FONT-FAMILY: Verdana; mso-fareast-font-family: Verdana; mso-bidi-font-family: Verdana"><span style="mso-list: Ignore">1．<span style="FONT: 7pt &#39;Times New Roman&#39;"> </span></span></span></b><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">首先，肯定是需要一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">数组</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"> ,</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">分别用来和每一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">通信</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 49.45pt; TEXT-INDENT: -27pt; LINE-HEIGHT: 18pt; mso-char-indent-count: -3.0; mso-line-height-rule: exactly; mso-para-margin-left: 2.14gd"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">其次，因为重叠模型中每一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">操作都是要“绑定”一个重叠结构的，所以需要为每一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">操作搭配一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAOVERLAPPED</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构，但是这样说并不严格，因为如果每一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">同时只有一个操作，比如</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSARecv</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，那么一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">就可以对应一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAOVERLAPPED</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构，但是如果一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">上会有</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSARecv </span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">和</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSASend</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">两个操作，那么一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">肯定就要对应两个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAOVERLAPPED</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构，所以有多少个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">操作就会有多少个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAOVERLAPPED</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 49.45pt; TEXT-INDENT: -27pt; LINE-HEIGHT: 18pt; mso-char-indent-count: -3.0; mso-line-height-rule: exactly; mso-para-margin-left: 2.14gd"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">然后，同样是为每一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAOVERLAPPED</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构都要搭配一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAEVENT</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">事件，所以说有多少个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">操作就应该有多少个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAOVERLAPPED</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构，有多少个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAOVERLAPPED</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构就应该有多少个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAEVENT</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">事件，最好把</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET – WSAOVERLAPPED – WSAEVENT</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">三者的关联起来，到了关键时刻才会临危不乱：）</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 4.5pt; TEXT-INDENT: -4.5pt; LINE-HEIGHT: 18pt; mso-char-indent-count: -.5; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 22.5pt; TEXT-INDENT: -18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly; mso-list: l2 level1 lfo3; tab-stops: list 22.5pt"><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: red; FONT-FAMILY: Verdana; mso-fareast-font-family: Verdana; mso-bidi-font-family: Verdana"><span style="mso-list: Ignore">2．<span style="FONT: 7pt &#39;Times New Roman&#39;"> </span></span></span></b><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">不得不分作两个线程：</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 49.55pt; TEXT-INDENT: -27pt; LINE-HEIGHT: 18pt; mso-char-indent-count: -3.0; mso-line-height-rule: exactly; mso-para-margin-left: 2.15gd"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">一个用来循环监听端口，接收请求的连接，然后给在这个套接字上配合一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAOVERLAPPED</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">结构投递第一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSARecv</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">请求，然后进入第二个线程中等待操作完成。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 49.55pt; TEXT-INDENT: -27pt; LINE-HEIGHT: 18pt; mso-char-indent-count: -3.0; mso-line-height-rule: exactly; mso-para-margin-left: 2.15gd"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">第二个线程用来不停的对</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAEVENT</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">数组</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAWaitForMultipleEvents</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，等待任何一个重叠操作的完成，然后根据返回的索引值进行处理，处理完毕以后再继续投递另一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSARecv</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">请求。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 49.55pt; TEXT-INDENT: -9pt; LINE-HEIGHT: 18pt; mso-char-indent-count: -1.0; mso-line-height-rule: exactly; mso-para-margin-left: 3.86gd"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">这里需要注意一点的是，前面我是把</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAWaitForMultipleEvents</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">函数的参数设置为</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSA_<o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 22.55pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly; mso-para-margin-left: 2.15gd"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">INFINITE</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">的，但是在多客户端的时候这样就不</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">OK</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">了，需要设定一个超时时间，如果等待超时了再重新</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAWaitForMultipleEvents</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，因为</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAWaitForMultipleEvents</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">函数在没有触发的时候是阻塞在那里的，我们可以设想一下，这时如果监听线程忠接入了新的连接，自然也会为这个连接增加一个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">Event</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，但是</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">WSAWaitForMultipleEvents</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">还是阻塞在那里就不会处理这个新连接的</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">Event</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">了。也不知道说明白了没有。。。。。。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">-_-b </span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">可能在这里你也体会不到，真正编码的时候就会明白了。</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"> <span lang="EN-US"><o:p></o:p></span></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">其他还有不明白的地方可以参考我的代码，代码里也有比较详尽的注释</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">,<span style="mso-spacerun: yes">&nbsp; </span>Enjoy~~~<o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">不过可惜是为了照顾大多数人，使用的是</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">MFC</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">的代码，显得代码有些杂乱。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><b style="mso-bidi-font-weight: normal"><span style="COLOR: fuchsia; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana; mso-bidi-font-size: 10.5pt">六．</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="COLOR: fuchsia; FONT-FAMILY: Verdana; mso-bidi-font-size: 10.5pt"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span></b><b style="mso-bidi-font-weight: normal"><span style="COLOR: fuchsia; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana; mso-bidi-font-size: 10.5pt">已知问题</span></b><b style="mso-bidi-font-weight: normal"><span lang="EN-US" style="COLOR: fuchsia; FONT-FAMILY: Verdana; mso-bidi-font-size: 10.5pt"><o:p></o:p></span></b>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span></span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">这个已知问题是说我的代码中的已知问题，可不是重叠结构的已知问题：）</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-char-indent-count: 2.0; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">这个示例代码已经写好了很久了，这两天做最后测试的时候才发现竟然有两个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">Bug</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，而且还不是每次都会出现，</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">5555</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，我最近是实在没有精力去改了，如果有心的朋友能修改掉这两个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">Bug</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，那真是造福大家了，这篇文章都险些流产，我更没有经历去修改都快要淡忘了的代码的</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">Bug</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">了，我写在这里提醒一下大家了，反正这个代码也仅仅是抛砖引玉而已，而且我觉得比起代码来还是文字比较珍贵</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">^_^</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">，因为重叠模型的代码网上也还是有不少的。两个</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">Bug</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">是这样的：</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 48pt; TEXT-INDENT: -18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly; mso-list: l0 level2 lfo2; tab-stops: list 48.0pt"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: Verdana; mso-bidi-font-family: Verdana"><span style="mso-list: Ignore">1．<span style="FONT: 7pt &#39;Times New Roman&#39;">&nbsp; </span></span></span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">多个客户端在连续退出的时候，有时会出现异常；</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt 48pt; TEXT-INDENT: -18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly; mso-list: l0 level2 lfo2; tab-stops: list 48.0pt"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana; mso-fareast-font-family: Verdana; mso-bidi-font-family: Verdana"><span style="mso-list: Ignore">2．<span style="FONT: 7pt &#39;Times New Roman&#39;">&nbsp; </span></span></span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">有时多个客户端的接收缓冲区竟然会重叠到一起，就是说</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">A</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">客户端发送的数据后面会根有</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">B</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">客户端上次发来的数据。。。。。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">-_-b<o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: red; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">改进算法：</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">其实代码中的算法还有很多可以改进的地方，</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">limin</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">朋友就向我提及过几个非常好的改进算法，比如如何在</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">socket</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">数组中寻找空闲的</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">socket</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">用来通信，但是我并没有加到这份代码里面来，因为本来重叠模型的代码就比较杂，再加上这些东西恐怕反而会给初学者带来困难。但是非常欢迎各位和我讨论重叠模型的改进算法以及我代码中存在问题！</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">^_^<o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p>&nbsp;</o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">就说这么多吧，但愿你能通过这篇文章熟练的玩转重叠</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">IO</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">模型，就没有枉费我这番功夫了。</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">^_^<o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">敬请期待本系列下一篇拙作《手把手教你玩转</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana">SOCKET</span><span style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: 宋体; mso-ascii-font-family: Verdana; mso-hansi-font-family: Verdana">模型之完成例程篇》</span><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: blue; FONT-FAMILY: Verdana"><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: fuchsia; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 225pt; LINE-HEIGHT: 18pt; mso-char-indent-count: 25.0; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: fuchsia; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span>------<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span>Finished in DLUT | DIP<o:p></o:p></span>
</p>
<p class="MsoNormal" style="MARGIN: 0cm 0cm 0pt; TEXT-INDENT: 18pt; LINE-HEIGHT: 18pt; mso-line-height-rule: exactly"><span lang="EN-US" style="FONT-SIZE: 9pt; COLOR: fuchsia; FONT-FAMILY: Verdana"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; </span>------<span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </span><st1:chsdate w:st="on" year="2004" month="9" day="22" islunardate="False" isrocdate="False">2004-09-22</st1:chsdate><o:p></o:p></span>
</p>
    <div class="source_link_bottom"><a href="http://www.cnblogs.com/xw885/articles/129728.html">》点击查看原文...</a></div>
    <div class="a4_area"><a href="http://job.cnblogs.com/">程序员找工作，就在博客园</a></div>
</div>			
</div>
<script type="text/javascript" src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/google_service.js">
</script>
<script type="text/javascript">
    try {
        GS_googleAddAdSenseService("ca-pub-4210569241504288");
        GS_googleEnableAllServices();
    } catch (e) { }
</script><script src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/google_ads.js"></script>
<script type="text/javascript">
    try {
        GA_googleAddSlot("ca-pub-4210569241504288", "cnblogs_archive_top");
        GA_googleAddSlot("ca-pub-4210569241504288", "cnblogs_archive_bottom");
    } catch (e) { }
</script>
<script type="text/javascript">
    try {
        GA_googleFetchAds();
    } catch (e) { }
</script>
<div id="ad_top">
<script type="text/javascript">
    try {
        GA_googleFillSlot("cnblogs_archive_top");
    } catch (e) { }
</script><script src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/ads"></script><div id="google_ads_div_cnblogs_archive_top">
<ins style="width: 728px; height: 90px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; display: inline-table; position: relative; "><ins style="width: 728px; height: 90px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; display: block; position: relative; "><iframe id="google_ads_iframe_cnblogs_archive_top" name="google_ads_iframe_cnblogs_archive_top" width="728" height="90" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; position: absolute; top: 0px; left: 0px; "></iframe></ins></ins></div>
<script>GA_googleCreateDomIframe('google_ads_div_cnblogs_archive_top' ,'cnblogs_archive_top');</script>
</div>
<div id="ad_bottom">
<script type="text/javascript">
    try {
        GA_googleFillSlot("cnblogs_archive_bottom");
    } catch (e) { }
</script><script src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/ads(1)"></script><div id="google_ads_div_cnblogs_archive_bottom">
<ins style="width: 728px; height: 90px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; display: inline-table; position: relative; "><ins style="width: 728px; height: 90px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; display: block; position: relative; "><iframe id="google_ads_iframe_cnblogs_archive_bottom" name="google_ads_iframe_cnblogs_archive_bottom" width="728" height="90" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" style="border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; position: absolute; top: 0px; left: 0px; "></iframe></ins></ins></div>
<script>GA_googleCreateDomIframe('google_ads_div_cnblogs_archive_bottom' ,'cnblogs_archive_bottom');</script>
</div>
<script type="text/javascript" src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/shCore.js"></script>
<script type="text/javascript" src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/shLanguage.js"></script>
<script type="text/javascript">
    try {
        SyntaxHighlighter.config.clipboardSwf = 'http://common.cnblogs.com/flash/clipboard.swf';
        SyntaxHighlighter.all();
    } catch (e) { }
</script> 
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F02fd5f9634457187877fa1d896d9e100' type='text/javascript'%3E%3C/script%3E"));
</script><script src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/h.js" type="text/javascript"></script>
<span style="display:none"><script src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/stat.php" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=2325484" target="_blank" title="站长统计">站长统计</a><img src="./手把手教你玩转SOCKET模型之重叠I O篇（下）_files/stat.htm" border="0" width="0" height="0"></span> 



</body></html>